class RojeruDatePicker{constructor(t={}){if(this.options={input:null,type:"single",includeTime:!1,format:"dd/mm/YYYY",locale:"es",minDate:null,maxDate:null,onSelect:null,onClose:null,mode:"modal",closeOnOverlayClick:!0,weekStart:0,allowClear:!1,position:"auto",autoDarkMode:!0,title:null,initialValue:null,typeButtons:"solid"},Object.assign(this.options,t),!this.options.input)throw new Error('RojeruDatePicker: "input" es obligatorio.');!this.options.minDate||this.options.minDate instanceof Date||(this.options.minDate=new Date(this.options.minDate)),!this.options.maxDate||this.options.maxDate instanceof Date||(this.options.maxDate=new Date(this.options.maxDate)),this.state={start:null,end:null,time:this.options.includeTime?"00:00":null,currentView:new Date,inputValue:this.options.input.value||""},this.isDarkMode=this.detectDarkMode(),null!==this.options.initialValue&&this.parseInitialValue(),this._clickOutsideHandler=null,this._keydownHandler=null,this.attach()}handleInitialValue(){null===this.options.initialValue?(this.state={start:null,end:null,time:this.options.includeTime?"00:00":null,currentView:new Date,inputValue:this.options.input.value||""},this.options.input&&(this.options.input.value="")):this.parseInitialValue()}detectDarkMode(){return!!(document.documentElement.classList.contains("dark-mode")||document.body.classList.contains("dark-mode")||document.documentElement.classList.contains("dark")||document.body.classList.contains("dark")||document.documentElement.classList.contains("theme-dark")||document.body.classList.contains("theme-dark"))}attach(){if(!this.options.input.hasAttribute("data-rojeru-datepicker")&&(this.options.input.readOnly=!0,this.options.input.setAttribute("data-rojeru-datepicker","true"),this.options.input.addEventListener("click",()=>this.open()),this.options.input.addEventListener("keydown",t=>{"Escape"===t.key&&this.close(),"Enter"===t.key&&this.open()}),this.options.allowClear&&this.addClearButton(),this.state.start&&("range"!==this.options.type||this.state.end))){const t=this.formatOutput();this.options.input&&(this.options.input.value=t)}}addClearButton(){if(this.options.input.parentNode.querySelector(".rojeru-datepicker-clear"))return;const t=document.createElement("div");t.style.position="relative",t.style.display="inline-block";this.options.input.parentNode.insertBefore(t,this.options.input),t.appendChild(this.options.input);const e=document.createElement("button");e.className="rojeru-datepicker-clear",e.innerHTML="×",e.type="button",Object.assign(e.style,{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",fontSize:"18px",cursor:"pointer",color:"#888",display:this.options.input.value?"block":"none",zIndex:"1000"}),e.addEventListener("click",t=>{t.stopPropagation(),this.clear()}),t.appendChild(e);new MutationObserver(()=>{e.style.display=this.options.input.value?"block":"none"}).observe(this.options.input,{attributes:!0,attributeFilter:["value"]})}parseInitialValue(){const t=this.options.initialValue;if(t||""===t){if(this.state.start=null,this.state.end=null,"range"===this.options.type){if("string"==typeof t&&t.includes(" - ")){const[e,i]=t.split(" - ").map(t=>t.trim());if(this.state.start=this.parseDateInput(e),this.state.end=this.parseDateInput(i),t.includes(" ")){const e=t.match(/\s([0-2]?[0-9]:[0-5][0-9])/);e&&(this.state.time=e[1])}this.options.input&&this.state.start&&this.state.end&&(this.options.input.value=this.formatOutput())}else"object"==typeof t&&t.start&&t.end&&(this.state.start=this.parseDateInput(t.start),this.state.end=this.parseDateInput(t.end),this.state.time=t.time||null,this.options.input&&this.state.start&&this.state.end&&(this.options.input.value=this.formatOutput()));this.state.start&&(this.state.currentView=new Date(this.state.start))}else if(this.state.start=this.parseDateInput(t),this.state.start&&(this.state.currentView=new Date(this.state.start),this.options.input&&(this.options.input.value=this.formatOutput())),this.options.includeTime&&"string"==typeof t&&t.includes(" ")){const e=t.split(" ").find(t=>/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t));e&&(this.state.time=e)}this.options.input&&(this.state.inputValue=this.options.input.value)}}parseDateInput(t){if(t instanceof Date)return new Date(t);if("string"==typeof t){const e=t.split(" ")[0],i=[/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,/^(\d{4})-(\d{1,2})-(\d{1,2})$/,/^(\d{1,2})-(\d{1,2})-(\d{4})$/];for(const t of i){const i=e.match(t);if(i){let e,s,n;t.source.includes("/")?(e=parseInt(i[1]),s=parseInt(i[2])-1,n=parseInt(i[3])):t.source.startsWith("^\\d{4}")?(n=parseInt(i[1]),s=parseInt(i[2])-1,e=parseInt(i[3])):(e=parseInt(i[1]),s=parseInt(i[2])-1,n=parseInt(i[3]));const a=new Date(n,s,e);if(a.getFullYear()===n&&a.getMonth()===s&&a.getDate()===e)return a}}const s=new Date(t);if(!isNaN(s.getTime()))return s}return null}open(){this.overlay&&this.close();const t=this.options.input.getBoundingClientRect(),e=window.innerWidth<=768;if(this.overlay=document.createElement("div"),this.overlay.className="rojeru-datepicker-overlay",this.overlay.dataset.id="dp-"+Date.now()+"-"+Math.random().toString(36).substr(2,5),this.overlay.setAttribute("data-mode",this.options.mode),"dropdown"!==this.options.mode||e?Object.assign(this.overlay.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.4)",display:"flex",justifyContent:"center",alignItems:e?"flex-start":"center",padding:e?"20px 0":"0",backdropFilter:"blur(2px)",zIndex:1e4}):Object.assign(this.overlay.style,{position:"absolute",top:`${t.bottom+window.scrollY+4}px`,left:`${t.left+window.scrollX}px`,width:`${Math.max(t.width,320)}px`,zIndex:1e4,background:"transparent",display:"block"}),this.isDarkMode=this.detectDarkMode(),this.overlay.innerHTML="",this.overlay.innerHTML=this.renderTemplate(),document.body.appendChild(this.overlay),this.isDarkMode){const t=this.overlay.querySelector(".rojeru-datepicker");t&&t.classList.add("rojeru-dark-mode")}this.bindEvents(),this.updateView(),"dropdown"!==this.options.mode||e||this.adjustDropdownPosition(),setTimeout(()=>{const t=this.overlay.querySelector(".rojeru-datepicker-nav.prev")||this.overlay.querySelector(".rojeru-datepicker-month");t?.focus()},10);const i=document.querySelectorAll(".rojeru-datepicker-overlay");if(i.length>1)for(let t=0;t<i.length-1;t++)i[t].remove()}adjustDropdownPosition(){const t=this.overlay.querySelector(".rojeru-datepicker");if(!t)return;const e=t.getBoundingClientRect(),i=window.innerHeight,s=window.innerWidth;if("top"===this.options.position||e.bottom>i-10&&"bottom"!==this.options.position){const e=this.options.input.getBoundingClientRect(),i=this.overlay.getBoundingClientRect();t.style.top="auto",t.style.bottom=`${e.height+4}px`,this.overlay.style.top=e.top+window.scrollY-i.height-4+"px"}e.right>s-10&&(t.style.left="auto",t.style.right="0")}close(){if(!this.overlay)return;this._clickOutsideHandler&&(document.removeEventListener("click",this._clickOutsideHandler,!0),this._clickOutsideHandler=null),this._keydownHandler&&(document.removeEventListener("keydown",this._keydownHandler),this._keydownHandler=null);try{this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)}catch(t){console.warn("Error al eliminar overlay:",t)}const t=document.querySelectorAll(".rojeru-datepicker-overlay");t.length>1&&t.forEach(t=>t.remove()),this.overlay=null,"function"==typeof this.options.onClose&&this.options.onClose()}clear(){this.state.start=null,this.state.end=null,this.state.time=this.options.includeTime?"00:00":null,this.options.input.value="";const t=this.options.input.parentNode?.querySelector(".rojeru-datepicker-clear");t&&(t.style.display="none"),"function"==typeof this.options.onSelect&&this.options.onSelect(null),setTimeout(()=>this.close(),50)}bindEvents(){const t=this.overlay;if(!t)return;const e=t.querySelector(".rojeru-datepicker-nav.prev"),i=t.querySelector(".rojeru-datepicker-nav.next"),s=t.querySelector(".rojeru-datepicker-month"),n=t.querySelector(".rojeru-datepicker-year"),a=t.querySelector(".rojeru-datepicker-time-input"),o=t.querySelector(".rojeru-datepicker-btn.cancel"),r=t.querySelector(".rojeru-datepicker-btn.accept"),l=t.querySelector(".rojeru-datepicker-btn.clear");e.addEventListener("click",()=>this.navigate(-1)),i.addEventListener("click",()=>this.navigate(1)),s.addEventListener("change",t=>{const e=new Date(this.state.currentView);e.setMonth(parseInt(t.target.value)),this.state.currentView=e,this.updateView()}),n.addEventListener("change",t=>{const e=new Date(this.state.currentView);e.setFullYear(parseInt(t.target.value)),this.state.currentView=e,this.updateView()}),a&&(a.addEventListener("change",t=>{this.state.time=t.target.value}),a.addEventListener("input",t=>{this.state.time=t.target.value})),o.addEventListener("click",()=>this.close()),r.addEventListener("click",()=>this.acceptSelection()),l&&l.addEventListener("click",()=>this.clear()),this._keydownHandler=t=>{"Escape"===t.key&&this.close(),"ArrowLeft"===t.key&&this.navigate(-1),"ArrowRight"===t.key&&this.navigate(1)},document.addEventListener("keydown",this._keydownHandler),"modal"===this.options.mode?t.addEventListener("click",e=>{e.target===t&&this.options.closeOnOverlayClick&&this.close()}):(this._clickOutsideHandler=e=>{t.contains(e.target)||e.target===this.options.input||this.close()},document.addEventListener("click",this._clickOutsideHandler,!0))}navigate(t){const e=new Date(this.state.currentView);e.setMonth(e.getMonth()+t),this.state.currentView=e,this.updateView()}acceptSelection(){let t=null;if("range"===this.options.type?this.state.start&&this.state.end&&(t={start:this.state.start,end:this.state.end,time:this.state.time,formatted:this.formatOutput()}):this.state.start&&(t={date:this.state.start,time:this.state.time,formatted:this.formatOutput()}),t){this.options.input.value=t.formatted;const e=this.options.input.parentNode?.querySelector(".rojeru-datepicker-clear");e&&(e.style.display="block"),"function"==typeof this.options.onSelect&&this.options.onSelect(t),this.close()}}formatOutput(){if("range"===this.options.type){let t=`${this.formatDate(this.state.start)} - ${this.formatDate(this.state.end)}`;return this.state.time&&this.options.includeTime&&(t+=` ${this.state.time}`),t}{let t=this.formatDate(this.state.start);return this.state.time&&this.options.includeTime&&(t+=` ${this.state.time}`),t}}formatDate(t){if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),n=s.toString().slice(-2);return this.options.format.replace(/dd/g,e).replace(/d/g,t.getDate().toString()).replace(/mm/g,i).replace(/m/g,(t.getMonth()+1).toString()).replace(/YYYY/g,s.toString()).replace(/YY/g,n).replace(/yyyy/g,s.toString()).replace(/yy/g,n).replace(/y/g,s.toString())}renderTemplate(){const t="range"===this.options.type,e=this.options.includeTime,i=this.options.title&&""!==this.options.title.trim(),s=this.t.bind(this),n="outline"===this.options.typeButtons?"outline":"";return`\n    <div class="rojeru-datepicker ${t?"rojeru-datepicker-range":""} ${this.isDarkMode?"rojeru-dark-mode":""}">\n      ${i?`<div class="rojeru-datepicker-title">${this.options.title}</div>`:""}\n      <div class="rojeru-datepicker-header">\n        <button class="rojeru-datepicker-nav prev ${n}" aria-label="${s("mes_anterior")}">&lt;</button>\n        <div class="rojeru-datepicker-controls">\n          <select class="rojeru-datepicker-month ${n}" aria-label="${s("seleccionar_mes")}"></select>\n          <select class="rojeru-datepicker-year ${n}" aria-label="${s("seleccionar_anio")}"></select>\n        </div>\n        <button class="rojeru-datepicker-nav next ${n}" aria-label="${s("mes_siguiente")}">&gt;</button>\n      </div>\n      \n      <div class="rojeru-datepicker-body"></div>\n      \n      ${e?`\n        <div class="rojeru-datepicker-time">\n          <label>${s("hora")}:</label>\n          <input type="time" class="rojeru-datepicker-time-input ${n}" value="${this.state.time||"00:00"}">\n        </div>\n      `:""}\n      \n      ${t?`\n        <div class="rojeru-datepicker-range-info">\n          <div class="rojeru-datepicker-selected start" style="display:none;">\n            <strong>${s("desde")}:</strong> <span></span>\n          </div>\n          <div class="rojeru-datepicker-selected end" style="display:none;">\n            <strong>${s("hasta")}:</strong> <span></span>\n          </div>\n        </div>\n      `:""}\n      \n      <div class="rojeru-datepicker-footer">\n        ${this.options.allowClear?`<button class="rojeru-datepicker-btn clear ${n}">${s("limpiar")}</button>`:""}\n        <button class="rojeru-datepicker-btn cancel ${n}">${s("cancelar")}</button>\n        <button class="rojeru-datepicker-btn accept ${n}" disabled>${s("aceptar")}</button>\n      </div>\n    </div>\n  `}updateView(){const{currentView:t}=this.state,e=t.getMonth(),i=t.getFullYear(),s=this.overlay.querySelector(".rojeru-datepicker-month"),n=this.overlay.querySelector(".rojeru-datepicker-year"),a=this.overlay.querySelector(".rojeru-datepicker-body");if(!s||!n||!a)return void console.error("Elementos del datepicker no encontrados");this.updateMonthSelect(s,e),this.updateYearSelect(n,i),a.innerHTML="";this.getWeekDays().forEach(t=>{const e=document.createElement("div");e.className="rojeru-datepicker-weekday",e.textContent=t,e.setAttribute("aria-label",t),a.appendChild(e)});let o=new Date(i,e,1).getDay()-this.options.weekStart;o<0&&(o+=7);const r=new Date(i,e,0).getDate();for(let t=o-1;t>=0;t--){const e=document.createElement("div"),i=r-t;e.textContent=i,e.className="rojeru-datepicker-day rojeru-datepicker-day-outside",a.appendChild(e)}const l=new Date(i,e+1,0).getDate(),c=new Date;c.setHours(0,0,0,0);const d="outline"===this.options.typeButtons?"outline":"";for(let t=1;t<=l;t++){const s=document.createElement("button");s.className=`rojeru-datepicker-day ${d}`,s.textContent=t,s.type="button";const n=new Date(i,e,t);s.dataset.date=n.toISOString();let o=!1;"range"===this.options.type&&this.state.start&&this.state.end&&(o=n>=this.state.start&&n<=this.state.end);const r=this.state.start&&n.getTime()===this.state.start.getTime(),l=this.state.end&&n.getTime()===this.state.end.getTime(),p=r||l,u=n.getTime()===c.getTime();p?s.classList.add("selected"):o?s.classList.add("in-range"):u&&s.classList.add("today");this.isDateDisabled(n)?(s.classList.add("disabled"),s.disabled=!0):(s.addEventListener("click",()=>this.handleDayClick(n)),s.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.handleDayClick(n))})),a.appendChild(s)}this.updateAcceptButton(),this.updateRangeInfo()}getWeekDays(){const t={es:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},e=t[this.options.locale]||t.es;return 1===this.options.weekStart?[...e.slice(1),e[0]]:e}isDateDisabled(t){const e=this.options.minDate,i=this.options.maxDate;return!!(e&&t<e)||!!(i&&t>i)}updateMonthSelect(t,e){t.innerHTML="";this.getMonths().forEach((i,s)=>{const n=document.createElement("option");n.value=s,n.textContent=i,n.selected=s===e,t.appendChild(n)})}updateYearSelect(t,e){t.innerHTML="";const i=e-50,s=e+10;for(let n=10*Math.floor(i/10);n<=s;n+=10){const a=document.createElement("optgroup");a.label="es"===this.options.locale?`Década ${n}s`:`${n}s`,t.appendChild(a);for(let t=n;t<n+10&&t<=s;t++)if(t>=i){const i=document.createElement("option");i.value=t,i.textContent=t.toString(),i.selected=t===e,a.appendChild(i)}}}getMonths(){const t=[];for(let e=0;e<12;e++){const i=new Date(2023,e,1);t.push(new Intl.DateTimeFormat(this.options.locale,{month:"long"}).format(i).charAt(0).toUpperCase()+new Intl.DateTimeFormat(this.options.locale,{month:"long"}).format(i).slice(1))}return t}handleDayClick(t){t.setHours(0,0,0,0),"range"===this.options.type?!this.state.start||this.state.end?(this.state.start=t,this.state.end=null):t>=this.state.start?this.state.end=t:(this.state.end=this.state.start,this.state.start=t):this.state.start=t,this.updateView()}updateAcceptButton(){const t=this.overlay.querySelector(".rojeru-datepicker-btn.accept");t&&("range"===this.options.type?t.disabled=!(this.state.start&&this.state.end):t.disabled=!this.state.start)}updateRangeInfo(){if("range"!==this.options.type)return;const t=this.overlay.querySelector(".rojeru-datepicker-selected.start"),e=this.overlay.querySelector(".rojeru-datepicker-selected.end");t&&this.state.start?(t.style.display="block",t.querySelector("span").textContent=this.formatDate(this.state.start)):t&&(t.style.display="none"),e&&this.state.end?(e.style.display="block",e.querySelector("span").textContent=this.formatDate(this.state.end)):e&&(e.style.display="none")}t(t){const e={es:{hora:"Hora",desde:"Desde",hasta:"Hasta",aceptar:"Aceptar",cancelar:"Cancelar",limpiar:"Limpiar",mes_anterior:"Mes anterior",mes_siguiente:"Mes siguiente",seleccionar_mes:"Seleccionar mes",seleccionar_anio:"Seleccionar año",diasSemana:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},en:{hora:"Time",desde:"From",hasta:"To",aceptar:"Accept",cancelar:"Cancel",limpiar:"Clear",mes_anterior:"Previous month",mes_siguiente:"Next month",seleccionar_mes:"Select month",seleccionar_anio:"Select year",diasSemana:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}};return(e[this.options.locale]||e.es)[t]||`[${t}]`}}"undefined"!=typeof module&&module.exports?module.exports=RojeruDatePicker:"function"==typeof define&&define.amd?define([],function(){return RojeruDatePicker}):"undefined"!=typeof window&&(window.RojeruDatePicker=RojeruDatePicker);